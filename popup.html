<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Discord Presence</title>
    <link rel="stylesheet" href="popup/popup.css">
</head>
<body>
    <div class="header">
        <h1>
            <img src="icons/icon128.png"
                 alt="" style="width: 18px; height: 18px; vertical-align: middle; margin-right: 6px; border-radius: 3px;">
            Anime Discord Presence
        </h1>
        <p>Show your anime activity on Discord</p>
    </div>

    <div class="tabs">
        <div class="tab active" data-tab="status">Status</div>
        <div class="tab" data-tab="rpc">RPC Settings</div>
        <div class="tab" data-tab="display">Display</div>
    </div>

    <div id="statusTab" class="tab-content active">
        <div id="connectionStatus" class="connection-status disconnected">
            <span class="status-dot"></span>
            <span id="connectionText">Connecting to Discord...</span>
        </div>

        <div id="nowWatching" class="now-watching" style="display: none;">
            <div class="now-watching-header">Now Watching</div>
            <div class="anime-card">
                <img id="animeThumbnail" class="anime-thumbnail" src="" alt="">
                <div class="anime-info">
                    <div id="animeTitle" class="anime-title">Loading...</div>
                    <div id="episodeInfo" class="episode-info">Episode 1</div>
                    <div id="playStatus" class="play-status playing">Playing</div>
                </div>
            </div>
            <div class="progress-container" style="margin-top: 10px;">
                <div class="progress-bar" id="progressBar">
                    <div id="progressFill" class="progress-fill" style="width: 0%">
                        <div class="progress-thumb"></div>
                    </div>
                </div>
                <div class="progress-time">
                    <span id="currentTime">0:00</span>
                    <span id="duration">0:00</span>
                </div>
            </div>
            <div class="playback-controls">
                <button class="control-btn" id="seekBackBtn" title="Back 10s">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>
                </button>
                <button class="control-btn control-btn-main" id="playPauseBtn" title="Play/Pause">
                    <svg id="playIcon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                    <svg id="pauseIcon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="display:none"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                </button>
                <button class="control-btn" id="seekForwardBtn" title="Forward 10s">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 5V1l5 5-5 5V7c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6h2c0 4.42-3.58 8-8 8s-8-3.58-8-8 3.58-8 8-8z"/></svg>
                </button>
                <select id="speedSelect" class="speed-select" title="Playback Speed">
                    <option value="0.5">0.5x</option>
                    <option value="0.75">0.75x</option>
                    <option value="1" selected>1x</option>
                    <option value="1.25">1.25x</option>
                    <option value="1.5">1.5x</option>
                    <option value="2">2x</option>
                </select>
            </div>
        </div>

        <div id="idleState" class="idle-state">
            <div class="idle-icon">TV</div>
            <p>Open an anime site to start<br>showing your activity</p>
        </div>

        <div class="toggle-row">
            <div>
                <div class="toggle-sublabel">Show activity on Discord</div>
            </div>
            <label class="toggle">
                <input type="checkbox" id="enableToggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>

        <div class="toggle-row">
            <div>
                <span class="toggle-label">Auto-Skip Intros/Credits</span>
                <div class="toggle-sublabel">Automatically skip intros, recaps, and credits</div>
            </div>
            <label class="toggle">
                <input type="checkbox" id="autoSkip">
                <span class="toggle-slider"></span>
            </label>
        </div>
    </div>

    <div id="rpcTab" class="tab-content">
        <div class="settings-section">
            <div class="settings-title">Discord Application</div>
            <div class="input-row">
                <label class="input-label">Client ID</label>
                <input type="text" id="clientId" class="text-input" placeholder="Enter your Discord Application Client ID" maxlength="20">
                <div style="font-size: 10px; color: rgba(255,255,255,0.4); margin-top: 4px;">
                    Get this from the <a href="#" id="discordDevLink" style="color: #5865f2; text-decoration: underline;">Discord Developer Portal</a>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <div class="settings-title">Discord Embed Options</div>

            <div class="toggle-row">
                <div>
                    <span class="toggle-label">Show Play/Pause State</span>
                    <div class="toggle-sublabel">Display if video is playing or paused</div>
                </div>
                <label class="toggle">
                    <input type="checkbox" id="showPlayState" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <div class="toggle-row">
                <div>
                    <span class="toggle-label">Show Timestamp</span>
                    <div class="toggle-sublabel">Show elapsed time on Discord</div>
                </div>
                <label class="toggle">
                    <input type="checkbox" id="showTimestamp" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <div class="toggle-row">
                <div>
                    <span class="toggle-label">Show Progress Bar</span>
                    <div class="toggle-sublabel">Spotify-style progress visualization</div>
                </div>
                <label class="toggle">
                    <input type="checkbox" id="showProgressBar" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>

        </div>

        <div class="settings-section">
            <div class="settings-title">Custom Text</div>

            <div class="input-row">
                <label class="input-label">Idle Status Text</label>
                <input type="text" id="idleStatus" class="text-input" placeholder="Browsing Anime" maxlength="128">
            </div>
        </div>

        <button id="saveSettings" class="save-btn">Save Settings</button>
    </div>

    <div id="displayTab" class="tab-content">
        <div class="settings-section">
            <div class="settings-title">Extension Display</div>

            <div class="toggle-row">
                <div>
                    <span class="toggle-label">Dark Mode</span>
                    <div class="toggle-sublabel">Use dark theme (always on)</div>
                </div>
                <label class="toggle">
                    <input type="checkbox" id="darkMode" checked disabled>
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <div class="toggle-row">
                <div>
                    <span class="toggle-label">Compact Mode</span>
                    <div class="toggle-sublabel">Smaller popup window</div>
                </div>
                <label class="toggle">
                    <input type="checkbox" id="compactMode">
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <div class="toggle-row">
                <div>
                    <span class="toggle-label">Show Thumbnails</span>
                    <div class="toggle-sublabel">Display anime thumbnails</div>
                </div>
                <label class="toggle">
                    <input type="checkbox" id="showThumbnails" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>

        <div class="settings-section">
            <div class="settings-title">Accent Color</div>

            <div class="input-row">
                <label class="input-label">Theme Color</label>
                <select id="accentColor" class="select-input">
                    <option value="orange">Anime Orange</option>
                    <option value="purple">Discord Purple</option>
                    <option value="blue">Ocean Blue</option>
                    <option value="green">Emerald Green</option>
                    <option value="pink">Sakura Pink</option>
                    <option value="red">Ruby Red</option>
                </select>
            </div>
        </div>

        <button id="saveDisplaySettings" class="save-btn">Apply Theme</button>
    </div>

    <div id="setupScreen">
        <div style="text-align: center; margin-bottom: 16px;">
            <img src="icons/icon128.png"
                 alt="" style="width: 48px; height: 48px; border-radius: 10px; margin-bottom: 8px;">
            <div class="setup-title">Setup Guide</div>
            <div class="setup-desc">One-time setup to connect with Discord.<br>Takes about 2 minutes!</div>
        </div>

        <div class="settings-section">
            <div class="settings-title">Step 1: Install Python</div>
            <div class="setup-desc-small">Required to bridge Chrome and Discord. If you already have it, skip this step.</div>
            <div class="setup-steps">
                <div class="setup-step">
                    <span class="setup-num">1</span>
                    <span>Download Python from <a href="#" id="pythonDownloadLink">python.org/downloads</a></span>
                </div>
                <div class="setup-step">
                    <span class="setup-num">2</span>
                    <span>Run installer &mdash; <strong>check "Add to PATH"</strong> at the bottom!</span>
                </div>
                <div class="setup-step">
                    <span class="setup-num">3</span>
                    <span>Click Install Now, done</span>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <div class="settings-title">Step 2: Create Discord Application</div>
            <div class="setup-desc-small">This is how Discord knows what to show on your profile.</div>
            <div class="setup-steps">
                <div class="setup-step">
                    <span class="setup-num">1</span>
                    <span>Open the <a href="#" id="setupDevPortalLink">Discord Developer Portal</a></span>
                </div>
                <div class="setup-step">
                    <span class="setup-num">2</span>
                    <span>Click <strong>New Application</strong>, name it anything (e.g. "Crunchyroll")</span>
                </div>
                <div class="setup-step">
                    <span class="setup-num">3</span>
                    <span>On the <strong>General Information</strong> page, copy the <strong>Application ID</strong></span>
                </div>
                <div class="setup-step">
                    <span class="setup-num">4</span>
                    <span><em>Optional:</em> Go to <strong>Rich Presence &gt; Art Assets</strong>, upload an image named <strong>logo</strong></span>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <div class="settings-title">Step 3: Paste Your Application ID</div>
            <div class="input-row">
                <input type="text" id="setupClientId" class="text-input" placeholder="Paste Application ID here" maxlength="20">
            </div>
        </div>

        <div class="settings-section">
            <div class="settings-title">Step 4: Run the Installer</div>
            <div class="setup-desc-small">This registers the connection between Chrome and Discord on your PC.</div>
            <div class="setup-steps">
                <div class="setup-step">
                    <span class="setup-num">1</span>
                    <span>Click <strong>Download Installer</strong> below</span>
                </div>
                <div class="setup-step">
                    <span class="setup-num">2</span>
                    <span>Run the downloaded file (you might need to click "More info" &gt; "Run anyway")</span>
                </div>
                <div class="setup-step">
                    <span class="setup-num">3</span>
                    <span>Wait for it to say "Done!"</span>
                </div>
            </div>
            <button id="downloadInstaller" class="setup-btn">Download Installer</button>
        </div>

        <button id="retryConnection" class="setup-btn" style="margin-top: 12px;">Save & Connect</button>
        <div class="setup-hint">
            Having issues? Make sure <a href="#" id="pythonHelpLink">Python</a> is installed and Discord is open.
        </div>
    </div>

    <script src="popup/theme.js"></script>
    <script src="popup/controls.js"></script>
    <script src="popup/settings.js"></script>
    <script src="popup/installer.js"></script>
    <script src="popup/main.js"></script>
</body>
</html>
